<script type="text/javascript">
    function showlink() {
      
    $('#thisLink').show();
   
    }
</script>
<p id="notice"><%= notice %></p>
<div id="artistInfo" style ="

<%= "border: 3px solid blue;" if current_user && current_user.following?(@artist) %>
">
<p>

  <%= @artist.name %>
<% if user_signed_in? %>
  <div id="follow_artist">
    <%= render :partial => "shared/follow_user", :locals => {:artist => @artist} %>
  </div>
<% end %>
</p>

<!--<p>
  <strong>Bio:</strong>
  <%= @artist.bio %>
</p>
-->

<h3>User ratings</h3>


<% if user_signed_in? %>
<p>Averate rating</p>
<div id="star"></div>

<p>Your rating</p>
<div id="user_star"></div>
 <%= javascript_include_tag 'jquery.raty' %>
<script type="text/javascript">
  $('#star').raty({
    readOnly: true,
    score: <%= @artist.average_rating %>,
    path: '/assets'
  });

  $('#user_star').raty({
    score: <%= @rating.score %>,
    path: '/assets',
    click: function(score, evt) {
      $.ajax({
        url: '/ratings/' + <%= @rating.id %>,
        type: 'PATCH',
        data: { score: score }
      });
    }
  });
</script>
<% else %>
<p>Sign in to see ratings</p>
<% end %>




</div>
<div id="musics_wrapper">

  <% @artist.musics.each do |music| %>
  <p><%= music.name%></p>
<p><%=link_to (image_tag(music.video_img)), music.link%></p>
<%= music.video_img %>
<p><%= music.duration %></p>
<p><%=pluralize(music.votes_for.size, "favorites")%></p>
<% if user_signed_in?  %>
  <%if current_user.voted_on?(music) %>
    <p>You favorited this artist</p>
    
  <% else %>
    <%= link_to 'Favorite',like_artist_music_path(@artist,music),method: :post, class: "glyphicon glyphicon-star" %>
  <% end %>
<% else %>
<%= link_to "Sign in to like this song", new_user_session_path %>
<% end %>

<%= link_to "Delete", artist_music_path(@artist, music.id),method: :delete,data: {confirm: "Are you sure?" } %>


<% if user_signed_in? %>

<p>Your rating</p>
<div id="music_<%= music.id%>_rating"></div>
<%# get_rating(music).id %>
<script type="text/javascript">
  
  $('#music_<%= music.id %>_rating').raty({
    score: <%= @rating.score %>,
    path: '/assets',
    click: function(score, evt) {
      $.ajax({
        url: '/ratings/' + <%= get_rating(music).id %>,
        type: 'PATCH',
        data: { score: score,music_id:<%= music.id %> }
      });
    }
  });
</script>
<% end %>

  <% end %>
  <%# render @artist.musics  %>

<h1>Add new music for this artist</h1>
<p>
<%= form_for ([@artist,@artist.musics.build]) do |f| %>
 <div class="field">
    <%= f.label :name %><br>
    <%= f.text_field :name %>
  </div>
  

  <p>
 <%= f.radio_button :link_type, 'youtube' %> 
  <%= f.label :link_type, image_tag("youtube.png"), :value => 'youtube', onclick: 'showlink();' %>
 <%= f.radio_button :link_type, 'spotify' %> 
  <%= f.label :link_type, image_tag("spotify.png"), :value => 'spotify', onclick: 'showlink();' %>
 <%= f.radio_button :link_type, 'itunes' %> 
  <%= f.label :link_type, image_tag("itunes.png"), :value => 'itunes', onclick: 'showlink();' %>
  <div id="thisLink" style="display:none">
    <%= f.label :link %><br>
    <%= f.text_area :link %>
  </div>
  </p>


 <%# f.hidden_field :artist_id, @artist.id %>
<%= f.button :submit, class: 'btn' %>
<% end %>
</p>


<p><%=pluralize(@artist.get_likes.size, "favorite")%></p>
<% if user_signed_in?  %>
  <%if current_user.voted_for?(@artist) %>
    <p>You favorited this artist</p>
  <% else %>
    <%= link_to 'Favorite',like_artist_path(@artist),method: :post, class: "glyphicon glyphicon-star" %>
  <% end %>
<% else %>
<%= link_to "Sign in to favorite this song", new_user_session_path %>
<% end %>


<%= link_to 'Edit', edit_artist_path(@artist) %> |
<%= link_to 'Back', artists_path %>
